generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Account {
  id           String   @id @default(cuid())
  login        String   @unique
  passHash     String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  characters   Character[]
}

model Character {
  id           String   @id @default(cuid())
  accountId    String
  name         String
  race         String
  classId      String
  sex          String

  level        Int      @default(1)
  exp          BigInt   @default(0)
  sp           Int      @default(0)

  adena        Int      @default(0)
  aa           Int      @default(0)  // Ancient Adena
  coinLuck     Int      @default(0)

  // Один JSON під "героя" (статі, hp/mp/cp, бафи, позиція, що завгодно)
  heroJson     Json     @default("{}")

  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  account      Account  @relation(fields: [accountId], references: [id], onDelete: Cascade)
  inventory    InventoryItem[]

  @@index([accountId])
  @@unique([accountId, name])
}

model InventoryItem {
  id           String   @id @default(cuid())
  characterId  String

  itemId       String   // твій внутрішній id типу "weapon_demon_c"
  qty          Int      @default(1)
  equippedSlot String?  // "weapon" | "shield" | "head" ...
  meta         Json     @default("{}") // заточка, елементи, кастомні поля

  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  character    Character @relation(fields: [characterId], references: [id], onDelete: Cascade)

  @@index([characterId])
  @@index([characterId, itemId])
}

model Kv {
  key        String   @id
  value      String
  updatedAt  DateTime @updatedAt
}
