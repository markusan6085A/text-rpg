# ‚úÖ –§—ñ–Ω–∞–ª—å–Ω–∏–π —á–µ–∫–ª–∏—Å—Ç –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏

## üîí Optimistic Locking

- [x] –°–µ—Ä–≤–µ—Ä —Å–∞–º –≥–µ–Ω–µ—Ä—É—î —Ä–µ–≤—ñ–∑—ñ—é (–Ω–µ –¥–æ–≤—ñ—Ä—è—î –∫–ª—ñ—î–Ω—Ç—É)
- [x] –†–µ–≤—ñ–∑—ñ—è —ñ–Ω–∫—Ä–µ–º–µ–Ω—Ç–∏—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –ø—Ä–∏ —É—Å–ø—ñ—à–Ω–æ–º—É –∑–∞–ø–∏—Å—ñ (–ø—ñ—Å–ª—è –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó)
- [x] **100% –∞—Ç–æ–º–∞—Ä–Ω—ñ—Å—Ç—å**: —É–º–æ–≤–Ω–∏–π UPDATE –Ω–∞ —Ä—ñ–≤–Ω—ñ –ë–î
  - `UPDATE ... WHERE id = ? AND (heroJson->>'heroRevision')::bigint = expectedRevision`
  - –Ø–∫—â–æ `count = 0` ‚Üí 409 Conflict
  - –Ø–∫—â–æ `count = 1` ‚Üí —É—Å–ø—ñ—Ö
  - –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è –∑ `SELECT FOR UPDATE` –¥–ª—è –±–ª–æ–∫—É–≤–∞–Ω–Ω—è —Ä—è–¥–∫–∞
- [x] –ü—Ä–∏ 409 –ø–æ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è —Å–µ—Ä–≤–µ—Ä–Ω–∏–π state (heroRevision, heroJsonVersion, updatedAt)
- [x] –õ–æ–≥—É–≤–∞–Ω–Ω—è –∑ accountId, characterId, expectedRevision, currentRevision

## üîÑ Sync Policy

- [x] Server –∑–∞–≤–∂–¥–∏ –ø–µ—Ä–µ–º–∞–≥–∞—î (last-write-wins)
- [x] Local –≤–µ—Ä—Å—ñ—è –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è —è–∫ backup –ø–µ—Ä–µ–¥ –∑–∞–º—ñ–Ω–æ—é
- [x] Backup –º—ñ—Å—Ç–∏—Ç—å –¥–æ—Å—Ç–∞—Ç–Ω—ñ–π –∫–æ–Ω—Ç–µ–∫—Å—Ç (characterId, heroRevision, updatedAt, —Ç–æ—â–æ)
- [x] FIFO –º–µ—Ö–∞–Ω—ñ–∫–∞ backup-—ñ–≤ (–º–∞–∫—Å–∏–º—É–º 5, –Ω–∞–π—Å—Ç–∞—Ä—ñ—à—ñ –≤–∏–¥–∞–ª—è—é—Ç—å—Å—è)
- [x] –ù–µ–º–∞—î "—Ç–∏—Ö–æ—ó" –∞–≤—Ç–æ–∑–∞–º—ñ–Ω–∏ - –∑–∞–≤–∂–¥–∏ –ª–æ–≥—É—î—Ç—å—Å—è –∫–æ–Ω—Ñ–ª—ñ–∫—Ç

## ‚úÖ –í–∞–ª—ñ–¥–∞—Ü—ñ—è

- [x] –í–∞–ª—ñ–¥–∞—Ü—ñ—è –∑–∞—Å—Ç–æ—Å–æ–≤—É—î—Ç—å—Å—è –ø—Ä–∏ PUT `/characters/:id`
- [x] –ü—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ `heroJson = {}` (–≤–∞–ª—ñ–¥–∞—Ü—ñ—è –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–∞)
- [x] –ü–µ—Ä—à–∏–π save –∑–∞–≤–∂–¥–∏ –ø—Ä–æ—Ö–æ–¥–∏—Ç—å –≤–∞–ª—ñ–¥–∞—Ü—ñ—é
- [x] –õ–æ–≥—É–≤–∞–Ω–Ω—è –ø–æ–º–∏–ª–æ–∫ –∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º (accountId, characterId, revision)

## üö¶ Rate Limiting

- [x] –û–±–º–µ–∂–µ–Ω–Ω—è –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö endpoints
- [x] Retry-After header (—Å—Ç–∞–Ω–¥–∞—Ä—Ç HTTP)
- [x] X-RateLimit-* headers –¥–ª—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó
- [x] retryAfter —Ç–∞ resetAt –≤ body –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ

## ‚è∞ lastActivityAt

- [x] –û–Ω–æ–≤–ª—é—î—Ç—å—Å—è –ø—Ä–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—ñ heroJson (PUT –∑ heroJson)
- [x] –û–Ω–æ–≤–ª—é—î—Ç—å—Å—è –ø—Ä–∏ heartbeat
- [x] –û–Ω–æ–≤–ª—é—î—Ç—å—Å—è –ø—Ä–∏ –≤—ñ–¥–ø—Ä–∞–≤—Ü—ñ —á–∞—Ç—É
- [x] –ù–ï –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è –ø—Ä–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—ñ –æ–∫—Ä–µ–º–∏—Ö –ø–æ–ª—ñ–≤ –±–µ–∑ heroJson

## üîß Side-effect Endpoints

- [x] `/heal` —ñ–Ω–∫—Ä–µ–º–µ–Ω—Ç—É—î —Ä–µ–≤—ñ–∑—ñ—é –ø—Ä–∏ –∑–º—ñ–Ω—ñ heroJson
- [x] `/buff` —ñ–Ω–∫—Ä–µ–º–µ–Ω—Ç—É—î —Ä–µ–≤—ñ–∑—ñ—é –ø—Ä–∏ –∑–º—ñ–Ω—ñ heroJson
- [x] –õ–æ–≥—É–≤–∞–Ω–Ω—è –∑–º—ñ–Ω –¥–ª—è –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è

## üõ°Ô∏è –ü–æ–≤–µ–¥—ñ–Ω–∫–∞ –∫–ª—ñ—î–Ω—Ç–∞ –ø—Ä–∏ 409

- [x] –ù–ï —Ä–æ–±–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π force overwrite
- [x] –ó–±–µ—Ä—ñ–≥–∞—î –ª–æ–∫–∞–ª—å–Ω—É –≤–µ—Ä—Å—ñ—é —è–∫ backup
- [x] –í–∏–º–∞–≥–∞—î –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤—ñ–¥ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
- [x] –ü–æ–∫–∞–∑—É—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç

## üìã –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è

- [x] –ü–æ–≤–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è –≤ `SYNC_POLICY_DOCUMENTATION.md`
- [x] –ü—Ä–∏–∫–ª–∞–¥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è
- [x] –û–ø–∏—Å –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ñ–≤
- [x] –ü—Ä–∞–≤–∏–ª–∞ –≤–∏—Ä—ñ—à–µ–Ω–Ω—è –∫–æ–Ω—Ñ–ª—ñ–∫—Ç—ñ–≤

<hr style="border: none; border-top: 2px dotted #C9B36B; margin: 20px 0;">

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í—Å—ñ –∫—Ä–∏—Ç–∏—á–Ω—ñ –º–æ–º–µ–Ω—Ç–∏ –ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω—ñ —Ç–∞ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—ñ

**–î–∞—Ç–∞:** 2025-01-19
